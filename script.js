var tfl = [
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "1790374630",
        "operationType": 1,
        "vehicleId": "001",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLURMD",
        "destinationName": "Richmond Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 1572,
        "currentLocation": "Between Dagenham East and Becontree",
        "towards": "Richmond",
        "expectedArrival": "2019-05-27T11:41:06Z",
        "timeToLive": "2019-05-27T11:41:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-673929454",
        "operationType": 1,
        "vehicleId": "005",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Eastbound - Platform 1",
        "direction": "outbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUUPM",
        "destinationName": "Upminster Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 1212,
        "currentLocation": "At St. James's Park Platform 2",
        "towards": "Upminster",
        "expectedArrival": "2019-05-27T11:35:06Z",
        "timeToLive": "2019-05-27T11:35:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-1402696232",
        "operationType": 1,
        "vehicleId": "013",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLURMD",
        "destinationName": "Richmond Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 972,
        "currentLocation": "At East Ham Platform 1",
        "towards": "Richmond",
        "expectedArrival": "2019-05-27T11:31:06Z",
        "timeToLive": "2019-05-27T11:31:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-673536238",
        "operationType": 1,
        "vehicleId": "025",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLURMD",
        "destinationName": "Richmond Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 912,
        "currentLocation": "Between East Ham and Upton Park",
        "towards": "Richmond",
        "expectedArrival": "2019-05-27T11:30:06Z",
        "timeToLive": "2019-05-27T11:30:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "445234756",
        "operationType": 1,
        "vehicleId": "027",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Eastbound - Platform 1",
        "direction": "outbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUBKG",
        "destinationName": "Barking Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 162,
        "currentLocation": "At Aldgate East Platform 2",
        "towards": "Barking",
        "expectedArrival": "2019-05-27T11:17:36Z",
        "timeToLive": "2019-05-27T11:17:36Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-673601774",
        "operationType": 1,
        "vehicleId": "035",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "district",
        "lineName": "District",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLURMD",
        "destinationName": "Richmond Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 372,
        "currentLocation": "Between Bromley-by-Bow and Mile End",
        "towards": "Richmond",
        "expectedArrival": "2019-05-27T11:21:06Z",
        "timeToLive": "2019-05-27T11:21:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:33.297Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "1679388672",
        "operationType": 1,
        "vehicleId": "216",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Eastbound - Platform 1",
        "bearing": "",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 1692,
        "currentLocation": "Between Paddington and Edgware Road",
        "towards": "Check Front of Train",
        "expectedArrival": "2019-05-27T11:43:06Z",
        "timeToLive": "2019-05-27T11:43:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-1561506978",
        "operationType": 1,
        "vehicleId": "264",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Eastbound - Platform 1",
        "direction": "outbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUBKG",
        "destinationName": "Barking Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 72,
        "currentLocation": "Between Aldgate East and Whitechapel",
        "towards": "Barking",
        "expectedArrival": "2019-05-27T11:16:06Z",
        "timeToLive": "2019-05-27T11:16:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "129301733",
        "operationType": 1,
        "vehicleId": "265",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Eastbound - Platform 1",
        "direction": "outbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUBKG",
        "destinationName": "Barking Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 732,
        "currentLocation": "Approaching Farringdon",
        "towards": "Barking",
        "expectedArrival": "2019-05-27T11:27:06Z",
        "timeToLive": "2019-05-27T11:27:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "1679585280",
        "operationType": 1,
        "vehicleId": "266",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Eastbound - Platform 1",
        "direction": "outbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUBKG",
        "destinationName": "Barking Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 1332,
        "currentLocation": "At Baker Street Platform 5",
        "towards": "Barking",
        "expectedArrival": "2019-05-27T11:37:06Z",
        "timeToLive": "2019-05-27T11:37:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-1160402679",
        "operationType": 1,
        "vehicleId": "271",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUHSC",
        "destinationName": "Hammersmith (H&C Line) Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 432,
        "currentLocation": "Between Bromley-by-Bow and Bow Road",
        "towards": "Hammersmith",
        "expectedArrival": "2019-05-27T11:22:06Z",
        "timeToLive": "2019-05-27T11:22:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    },
    {
        "$type": "Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities",
        "id": "-890837585",
        "operationType": 1,
        "vehicleId": "277",
        "naptanId": "940GZZLUWPL",
        "stationName": "Whitechapel Underground Station",
        "lineId": "hammersmith-city",
        "lineName": "Hammersmith & City",
        "platformName": "Westbound - Platform 2",
        "direction": "inbound",
        "bearing": "",
        "destinationNaptanId": "940GZZLUHSC",
        "destinationName": "Hammersmith (H&C Line) Underground Station",
        "timestamp": "2019-05-27T11:14:54.2510325Z",
        "timeToStation": 1212,
        "currentLocation": "Between Barking and East Ham",
        "towards": "Hammersmith",
        "expectedArrival": "2019-05-27T11:35:06Z",
        "timeToLive": "2019-05-27T11:35:06Z",
        "modeName": "tube",
        "timing": {
            "$type": "Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities",
            "countdownServerAdjustment": "00:00:00",
            "source": "0001-01-01T00:00:00",
            "insert": "0001-01-01T00:00:00",
            "read": "2019-05-27T11:14:32.61Z",
            "sent": "2019-05-27T11:14:54Z",
            "received": "0001-01-01T00:00:00"
        }
    }
]



/*

H1

fragment = platform board
    div = pb_container
        platform header
        table
            tr
            tr
            tr
        platform header
        table
            tr
            tr
            tr
*/



// Create Station Name header element
var station_header = document.createElement('h1');
// Inserting the first station name in the array as station name
station_header.innerHTML = tfl[0].stationName;
// Adding the header to the HTML body
document.body.appendChild(station_header);




// Create a new fragment for the platform and it's board results
var platform_board = document.createDocumentFragment();
// Create a container div to add to the fragment
var pb_container = document.createElement('div');


function update_fragment() {
    // Append the container div to the fragment
    platform_board.appendChild(pb_container);

    // Append the fragment to HTML Body
    document.body.appendChild(platform_board);
}


function new_platform(current_loop) {
    // Creating a header element for platform name
    var pb_platform = document.createElement('h2');
    // Set platformName to pb_platform
    pb_platform.innerHTML = tfl[current_loop].platformName;
    // Append the platform name to the container
    pb_container.appendChild(pb_platform);
}

function create_table(_platform_) {
    // Create table for displaying results
    var table = document.createElement('table');
    table.setAttribute('id', _platform_);
    table.innerHTML = '<tr><th>Line</th><th>Destination</th><th>Arrival Time</th></tr>';
    pb_container.appendChild(table);

    update_fragment();
}


// Create table row
function create_tr(_id_, _parent_table_) {
    var tr = document.createElement('tr');
    tr.setAttribute("id", _id_);
    _parent_table_.appendChild(tr); 


    update_fragment();
}

// Create table cell
function create_td(_content_, _parent_row_) {

    var td = document.createElement('td');
    td.innerHTML = _content_;
    // currently how we're setting the class on line
    td.setAttribute("class", _content_);
    _parent_row_.appendChild(td); 
}


function write_board_results(current_loop, row_send) {
    
   


    create_td(tfl[current_loop].lineName, row_send);
    // create new cell for destination
    create_td(tfl[current_loop].towards, row_send);
    // create new cell for arrival time
    create_td(Math.round(tfl[current_loop].timeToStation / 60) +' mins', row_send);

    
    update_fragment();

}

function sort_table() {
    
}

function platforms() {

    // setting outside for loop so not to be overwritten every loop 
    var platforms_array = [];
    
    var row = 'row';
    var current_row = 0;

    // loop over platform and create new header
    for (var current_loop = 0; current_loop < tfl.length; current_loop++) {

        var current_platform = tfl[current_loop].platformName;
        


        if (platforms_array.includes(tfl[current_loop].platformName)) {

            // set the current loop platform table to send the new row to
            var table_send = document.getElementById(current_platform);

            // create variable for row id, so we can add cells to it
            current_row = current_row + 1;
            row_counter = current_row;
            row_id = row + row_counter;


            // create row in table_send id
            create_tr(row_id, table_send);
            

            // create variable for row so we can add cells
            var row_send = document.getElementById(row_id);
            

            write_board_results(current_loop, row_send);
        }

        else {
            // Add new Platfrom Header
            new_platform(current_loop);
            

            // create a table & add headers
            create_table(current_platform);


            // create variable for table id to add row to
            var table_send = document.getElementById(current_platform);


            // create variable for row id, so we can add cells to it
            current_row = current_row + 1;
            row_counter = current_row;
            row_id = row + row_counter;


            // create row in table_send id
            create_tr(row_id, table_send);
            

            // create variable for row so we can add cells
            var row_send = document.getElementById(row_id);
            
            
            // write the results for the platform board
            write_board_results(current_loop, row_send);


            // add this platformname to the array checker so we can add time to the correct tables
            platforms_array.push(tfl[current_loop].platformName);
        

            update_fragment();
        }
    }
}

platforms();

